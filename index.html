<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School Homework Portal</title>
<style>
:root {
  --bg: #f4f4f4;
  --panel: #fff;
  --primary: #4CAF50;
  --secondary: #2196F3;
}
body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  margin: 0; padding: 0;
}
.container { max-width: 900px; margin: auto; padding: 20px; }
.panel {
  background: var(--panel);
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}
input, textarea, select, button {
  width: 100%; padding: 10px; margin: 8px 0;
  border: 1px solid #ccc; border-radius: 4px;
}
button {
  background: var(--primary);
  color: white; border: none; cursor: pointer;
}
button:hover { opacity: 0.9; }
.hidden { display: none; }
.submission {
  background: #f9f9f9;
  padding: 10px; border-radius: 5px;
  margin-top: 10px;
}
</style>
</head>
<body>
<div class="container">
  <h1 style="text-align:center;">Homework Portal</h1>

  <!-- Login -->
  <div id="loginPanel" class="panel">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <small>New user? <a href="#" onclick="showRegister()">Register here</a></small>
  </div>

  <!-- Register -->
  <div id="registerPanel" class="panel hidden">
    <h2>Register</h2>
    <input id="regUsername" placeholder="Username">
    <input id="regPassword" type="password" placeholder="Password">
    <select id="regRole">
      <option value="student">Student</option>
      <option value="teacher">Teacher</option>
    </select>
    <button onclick="register()">Register</button>
    <small>Already have an account? <a href="#" onclick="showLogin()">Login</a></small>
  </div>

  <!-- Teacher Panel -->
  <div id="teacherPanel" class="panel hidden">
    <h2>Post Homework</h2>
    <input id="hwTitle" placeholder="Homework Title">
    <textarea id="hwDesc" rows="4" placeholder="Homework Details"></textarea>
    <button onclick="postHomework()">Post</button>
    <h2>Your Homeworks</h2>
    <div id="teacherHomeworkList"></div>
  </div>

  <!-- Student Panel -->
  <div id="studentPanel" class="panel hidden">
    <h2>Available Homeworks</h2>
    <div id="studentHomeworkList"></div>
  </div>
</div>

<script>
let currentUser = null;
const dbKey = "schoolPortalDB";

// Load database
function loadDB() {
  return JSON.parse(localStorage.getItem(dbKey)) || { users: [], homeworks: [] };
}
// Save database
function saveDB(db) {
  localStorage.setItem(dbKey, JSON.stringify(db));
}

// Registration
function register() {
  let username = document.getElementById("regUsername").value.trim();
  let password = document.getElementById("regPassword").value.trim();
  let role = document.getElementById("regRole").value;

  if (!username || !password) return alert("Fill all fields");

  let db = loadDB();
  if (db.users.some(u => u.username === username)) {
    return alert("Username already exists");
  }

  db.users.push({ username, password: btoa(password), role });
  saveDB(db);
  alert("Registration successful");
  showLogin();
}

// Login
function login() {
  let username = document.getElementById("username").value.trim();
  let password = document.getElementById("password").value.trim();

  let db = loadDB();
  let user = db.users.find(u => u.username === username && u.password === btoa(password));
  if (!user) return alert("Invalid login");

  currentUser = user;
  document.getElementById("loginPanel").classList.add("hidden");
  document.getElementById("registerPanel").classList.add("hidden");

  if (user.role === "teacher") {
    document.getElementById("teacherPanel").classList.remove("hidden");
    renderTeacherHomeworks();
  } else {
    document.getElementById("studentPanel").classList.remove("hidden");
    renderStudentHomeworks();
  }
}

// Post Homework
function postHomework() {
  let title = document.getElementById("hwTitle").value.trim();
  let desc = document.getElementById("hwDesc").value.trim();
  if (!title || !desc) return alert("Fill both fields");

  let db = loadDB();
  let hw = {
    id: Date.now(),
    title, desc,
    teacher: currentUser.username,
    submissions: []
  };
  db.homeworks.push(hw);
  saveDB(db);
  document.getElementById("hwTitle").value = "";
  document.getElementById("hwDesc").value = "";
  renderTeacherHomeworks();
}

// Render teacher homeworks
function renderTeacherHomeworks() {
  let db = loadDB();
  let list = document.getElementById("teacherHomeworkList");
  list.innerHTML = "";
  db.homeworks.filter(h => h.teacher === currentUser.username).forEach(hw => {
    let div = document.createElement("div");
    div.className = "submission";
    div.innerHTML = `<strong>${hw.title}</strong><p>${hw.desc}</p>
    <h4>Submissions:</h4>
    ${hw.submissions.length ? hw.submissions.map(s => `<p><b>${s.student}</b>: ${s.answer}</p>`).join("") : "<em>No submissions</em>"}`;
    list.appendChild(div);
  });
}

// Render student homeworks
function renderStudentHomeworks() {
  let db = loadDB();
  let list = document.getElementById("studentHomeworkList");
  list.innerHTML = "";
  db.homeworks.forEach(hw => {
    let div = document.createElement("div");
    div.className = "submission";
    div.innerHTML = `<strong>${hw.title}</strong><p>${hw.desc}</p>
    <textarea id="ans-${hw.id}" placeholder="Your answer"></textarea>
    <button onclick="submitAnswer(${hw.id})">Submit</button>`;
    list.appendChild(div);
  });
}

// Submit answer
function submitAnswer(hwId) {
  let answer = document.getElementById(`ans-${hwId}`).value.trim();
  if (!answer) return alert("Write an answer");

  let db = loadDB();
  let hw = db.homeworks.find(h => h.id === hwId);
  let existing = hw.submissions.find(s => s.student === currentUser.username);
  if (existing) {
    existing.answer = answer;
  } else {
    hw.submissions.push({ student: currentUser.username, answer });
  }
  saveDB(db);
  alert("Answer submitted");
}

// Show register/login
function showRegister() {
  document.getElementById("loginPanel").classList.add("hidden");
  document.getElementById("registerPanel").classList.remove("hidden");
}
function showLogin() {
  document.getElementById("registerPanel").classList.add("hidden");
  document.getElementById("loginPanel").classList.remove("hidden");
}
</script>
</body>
  </html>
