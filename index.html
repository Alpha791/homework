<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School Homework Portal</title>
<style>
:root {
  --bg: #f4f4f4;
  --panel: #fff;
  --primary: #4CAF50;
  --secondary: #2196F3;
}
body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  margin: 0; padding: 0;
}
.container { max-width: 900px; margin: auto; padding: 20px; }
.panel {
  background: var(--panel);
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}
input, textarea, select, button {
  width: 100%; padding: 10px; margin: 8px 0;
  border: 1px solid #ccc; border-radius: 4px;
}
button {
  background: var(--primary);
  color: white; border: none; cursor: pointer;
}
button:hover { opacity: 0.9; }
.hidden { display: none; }
.submission {
  background: #f9f9f9;
  padding: 10px; border-radius: 5px;
  margin-top: 10px;
}
</style>
</head>
<body>
<div class="container">
  <h1 style="text-align:center;">Homework Portal</h1>

  <!-- Login -->
  <div id="loginPanel" class="panel">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <button onclick="login()">Login</button>
    <small>New user? <a href="#" onclick="showRegister()">Register here</a></small>
  </div>

  <!-- Register -->
  <div id="registerPanel" class="panel hidden">
    <h2>Register</h2>
    <input id="regUsername" placeholder="Username">
    <select id="regRole">
      <option value="student">Student</option>
      <option value="teacher">Teacher</option>
    </select>
    <button onclick="register()">Register</button>
    <small>Already have an account? <a href="#" onclick="showLogin()">Login</a></small>
  </div>

  <!-- Teacher Panel -->
  <div id="teacherPanel" class="panel hidden">
    <h2>Post Homework</h2>
    <input id="subject" placeholder="Subject Offered">
    <input id="hwTitle" placeholder="Homework Title">
    <textarea id="hwDesc" rows="4" placeholder="Homework Details"></textarea>
    <input type="file" id="fileUpload" accept="image/*">
    <button onclick="postHomework()">Post Homework</button>
    <h2>Your Homeworks</h2>
    <div id="teacherHomeworkList"></div>
  </div>

  <!-- Student Panel -->
  <div id="studentPanel" class="panel hidden">
    <h2>Available Homeworks</h2>
    <div id="studentHomeworkList"></div>
  </div>
</div>

<script>
let currentUser = null;
const dbKey = "schoolPortalDB";

// Load database
function loadDB() {
  return JSON.parse(localStorage.getItem(dbKey)) || { users: [], homeworks: [] };
}
// Save database
function saveDB(db) {
  localStorage.setItem(dbKey, JSON.stringify(db));
}

// Registration
function register() {
  let username = document.getElementById("regUsername").value.trim();
  let role = document.getElementById("regRole").value;

  if (!username) return alert("Fill all fields");

  let db = loadDB();
  if (db.users.some(u => u.username === username)) {
    return alert("Username already exists");
  }

  db.users.push({ username, role });
  saveDB(db);
  alert("Registration successful");
  showLogin();
}

// Login (for students with no password)
function login() {
  let username = document.getElementById("username").value.trim();

  let db = loadDB();
  let user = db.users.find(u => u.username === username);
  if (!user) return alert("Invalid login");

  currentUser = user;
  document.getElementById("loginPanel").classList.add("hidden");
  document.getElementById("registerPanel").classList.add("hidden");

  if (user.role === "teacher") {
    document.getElementById("teacherPanel").classList.remove("hidden");
  } else {
    document.getElementById("studentPanel").classList.remove("hidden");
    renderStudentHomeworks();
  }
}

// Post Homework (with image upload)
function postHomework() {
  let title = document.getElementById("hwTitle").value.trim();
  let desc = document.getElementById("hwDesc").value.trim();
  let subject = document.getElementById("subject").value.trim();
  let file = document.getElementById("fileUpload").files[0];

  if (!title || !desc || !subject) return alert("Fill all fields");

  let db = loadDB();
  let homework = {
    id: Date.now(),
    title, desc, subject,
    teacher: currentUser.username,
    submissions: [],
    file: file ? URL.createObjectURL(file) : null // Store image URL
  };
  db.homeworks.push(homework);
  saveDB(db);

  // Clear form
  document.getElementById("hwTitle").value = "";
  document.getElementById("hwDesc").value = "";
  document.getElementById("subject").value = "";
  renderTeacherHomeworks();
}

// Render teacher homeworks
function renderTeacherHomeworks() {
  let db = loadDB();
  let list = document.getElementById("teacherHomeworkList");
  list.innerHTML = "";
  db.homeworks.filter(h => h.teacher === currentUser.username).forEach(hw => {
    let div = document.createElement("div");
    div.className = "submission";
    div.innerHTML = `
      <strong>${hw.title}</strong>
      <p>${hw.desc}</p>
      <p><strong>Subject:</strong> ${hw.subject}</p>
      ${hw.file ? `<img src="${hw.file}" width="100" height="100">` : ""}
      <h4>Submissions:</h4>
      ${hw.submissions.length ? hw.submissions.map(s => `<p><b>${s.student}</b>: ${s.answer} - <button onclick="markWork(${hw.id}, '${s.student}', 'correct')">Mark Correct</button> <button onclick="markWork(${hw.id}, '${s.student}', 'wrong')">Mark Wrong</button></p>`).join("") : "<em>No submissions</em>"}`;
    list.appendChild(div);
  });
}

// Render student homeworks
function renderStudentHomeworks() {
  let db = loadDB();
  let list = document.getElementById("studentHomeworkList");
  list.innerHTML = "";
  db.homeworks.forEach(hw => {
    let div = document.createElement("div");
    div.className = "submission";
    div.innerHTML = `
      <strong>${hw.title}</strong>
      <p>${hw.desc}</p>
      <p><strong>Subject:</strong> ${hw.subject}</p>
      <textarea id="ans-${hw.id}" placeholder="Your answer"></textarea>
      <button onclick="submitAnswer(${hw.id})">Submit</button>`;
    list.appendChild(div);
  });
}

// Submit answer
function submitAnswer(hwId) {
  let answer = document.getElementById(`ans-${hwId}`).value.trim();
  if (!answer) return alert("Write an answer");

  let db = loadDB();
  let hw = db.homeworks.find(h => h.id === hwId);
  let existing = hw.submissions.find(s => s.student === currentUser.username);
  if (existing) {
    existing.answer = answer;
  } else {
    hw.submissions.push({ student: currentUser.username, answer });
  }
  saveDB(db);
  alert("Answer submitted");
}

// Mark work as correct or wrong
function markWork(hwId, student, status) {
  let db = loadDB();
  let hw = db.homeworks.find(h => h.id === hwId);
  let submission = hw.submissions.find(s => s.student === student);
  if (submission) {
    submission.status = status;
    saveDB(db);
    alert(`${student}'s work marked as ${status}`);
    renderTeacherHomeworks();
  }
}

// Show register/login
function showRegister() {
  document.getElementById("loginPanel").classList.add("hidden");
  document.getElementById("registerPanel").classList.remove("hidden");
}
function showLogin() {
  document.getElementById("registerPanel").classList.add("hidden");
  document.getElementById("loginPanel").classList.remove("hidden");
}
</script>
</body>
  </html>
